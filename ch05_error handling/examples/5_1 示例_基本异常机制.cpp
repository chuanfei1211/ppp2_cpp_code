//=====================================================
// 第5章 错误处理 入门示例
// 目标：理解 try / throw / catch 的基本用法
//=====================================================


/*
=====================================================
【try —— 监视区】
=====================================================

try {
    // 可能会出错的代码
}

✔ 含义
  “我打算尝试执行这段代码，如果里面发生错误，我去 catch 那里处理。”

✔ 要点
  - try 后必须有 { }
  - try 后面必须跟至少一个 catch
  - try 里的代码一旦出现 throw，就会立即跳到 catch

✔ 用途
  try 用来包住那些“可能会失败”的代码，例如：
  - 输入（cin）
  - 运算（如除以零）
  - 打开文件
  - 访问数组等

✔ 强调
  try 本身不处理错误，它只是“监视”。
  真正处理错误的是 catch。
*/



/*
=====================================================
【throw —— 抛出错误】
=====================================================

throw runtime_error("输入格式错误（不是整数）");

✔ 作用
  - 立即停止当前函数的执行
  - 把错误“抛给”外层的 catch
  - 就像告诉上一级：“我搞不定了，你来处理！”

✔ runtime_error（错误类型）
  - C++ 标准库提供的一个错误类型
  - 表示：输入错误、文件错误、非法状态等
  - 本质是一个 class（类）

✔ 错误说明文字
  ("输入格式错误（不是整数）")
  - 这是你给错误写的说明文字
  - 最终由 e.what() 输出
*/



/*
=====================================================
【catch —— 接住错误】
=====================================================

catch (runtime_error& e)

✔ 含义
  “当 try 里抛出了一个 runtime_error 类型的错误时，我用 e 接住它。”

✔ 接收类型必须一致
  throw runtime_error("xxx");
  → catch(runtime_error& e)

  throw out_of_range("超范围");
  → catch(out_of_range& e)

✔ 为什么要用引用 &？
  - 避免复制错误对象
  - 获取更准确的 what() 内容
  - 更高效
*/



/*
=====================================================
【cerr << e.what() —— 输出错误内容】
=====================================================

cerr << "发生错误：" << e.what() << endl;

① cerr
   - C++ 的错误输出流（standard error）
   - 不带缓冲，立即输出
   - 不会与 cout 混在一起
   - 更适合打印错误信息

② e.what()
   - runtime_error 的成员函数
   - 返回 throw 时写的文字
     例如：
       throw runtime_error("不允许输入负数");
       e.what() → "不允许输入负数"

③ endl
   - 换行
   - 刷新输出流，使错误信息立即显示
*/



/*
=====================================================
【我的理解】
=====================================================
1. read_number 负责发现问题（throw）
2. main 负责统一处理问题（catch）
3. 大程序中，分离“正常逻辑”和“错误处理”可以让代码更干净
*/



#include <iostream>
#include <stdexcept>    // runtime_error 在这里定义
using namespace std;



//=====================================================
// 函数：读入一个整数，如果输入非法或为负数，抛出异常
//=====================================================
int read_number()
{
    cout << "请输入一个整数：";
    int x = 0;
    cin >> x;   // 尝试读取整数

    // 输入格式错误（如输入字母）
    if (!cin)
    {
        throw runtime_error("你输入的不是整数！！！");
    }

    // 输入负数（逻辑不合理）
    if (x < 0)
    {
        throw runtime_error("不允许输入负数");
    }

    return x;   // 正常返回
}



//=====================================================
// 主函数：使用 try/catch 统一处理来自 read_number 的错误
//=====================================================
int main()
{
    try
    {
        int value = read_number();      // 可能会抛异常
        cout << "你输入的是：" << value << endl;
    }
    catch (runtime_error& e)            // 捕获异常
    {
        cerr << "发生错误："            // 错误前缀提示
            << e.what()                // 输出 throw 的文字
            << endl;                   // 换行 + 刷新
    }

    return 0;
}



/*
=====================================================
【总结】
=====================================================

throw runtime_error("xxx");
→ “把错误丢出去”

catch (runtime_error& e)
→ “把错误接住”

e.what()
→ “错误的文字说明”

口诀：
    throw 负责抛，
    catch 负责接，
    e 是错误对象，
    what() 是错误内容。
=====================================================
*/
